import random
import time

# Function to create a random math question based on difficulty level
def create_question(difficulty):
    if difficulty == "easy":
        number_range = (1, 10)
    elif difficulty == "medium":
        number_range = (1, 25)
    else:  # hard
        number_range = (1, 50)

    num1 = random.randint(*number_range)
    num2 = random.randint(*number_range)
    operator = random.choice(["+", "-", "*"])
    expression = f"{num1} {operator} {num2}"
    correct_answer = eval(expression)
    return expression, correct_answer

# Function to present a single question to the user
def ask_question(expression, correct_answer):
    print(f"\nWhat is {expression}?")
    start_time = time.time()

    try:
        user_input = int(input("Your answer: "))
    except ValueError:
        print("Invalid input! Counted as incorrect.")
        return 0, None, int(time.time() - start_time)

    end_time = time.time()
    elapsed_time = end_time - start_time

    if user_input == correct_answer:
        if elapsed_time <= 5:
            score = 2
        else:
            score = 1
        print(f"Correct! (+{score} point(s), answered in {elapsed_time:.2f} seconds)")
    else:
        score = 0
        print(f"Incorrect. The correct answer was {correct_answer}.")

    return score, user_input, int(elapsed_time)

# Main game loop
def maths_quiz():
    print("=== Welcome to the Maths Quiz ===")
    print("Select difficulty level:")
    print("1) Easy (5 questions)")
    print("2) Medium (8 questions)")
    print("3) Hard (12 questions)")

    while True:
        choice = input("Enter 1, 2 or 3: ")
        if choice == "1":
            difficulty = "easy"
            total_questions = 5
            break
        elif choice == "2":
            difficulty = "medium"
            total_questions = 8
            break
        elif choice == "3":
            difficulty = "hard"
            total_questions = 12
            break
        else:
            print("Invalid selection. Please enter 1, 2, or 3.")

    print(f"\nYou selected {difficulty.capitalize()} mode.")
    print("The quiz will now begin...\n")

    total_score = 0
    results = []

    for question_number in range(1, total_questions + 1):
        expression, correct_answer = create_question(difficulty)
        print(f"Question {question_number}/{total_questions}")
        score, user_input, elapsed_time = ask_question(expression, correct_answer)
        total_score += score
        results.append((expression, correct_answer, user_input, score, elapsed_time))

    # Final results
    print("\n=== Quiz Completed ===")
    print(f"Final Score: {total_score}/{total_questions * 2}")
    percentage = round((total_score / (total_questions * 2)) * 100, 2)
    print(f"Percentage: {percentage}%")

    print("\n--- Question Breakdown ---")
    print("No.  Question     Your Ans   Correct Ans   Score   Time(s)")
    print("----------------------------------------------------------")
    for index, (expr, correct, user_ans, score, time_taken) in enumerate(results, 1):
        print(f"{index:<4} {expr:<11} {str(user_ans):<10} {correct:<12} {score:<6} {time_taken}")

# Entry point
if __name__ == "__main__":
    maths_quiz()
